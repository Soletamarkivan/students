<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-registration</title>
    <link rel="icon" type="image/x-icon" href="./assets/svg/ollcLogoNoName.svg">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="shortcut icon" href="./assets/svg/ollcLogoNoName.svg" type="image/x-icon">
</head>
<body>
    <div class="font-[roboto-serif]">
        <div id="topbarContainer"></div>
        <div class="w-full"><img src="./assets/img/admission-banner.png" class="w-full" alt=""></div>
        <form action="./php/pre-registration.php" method="post" onsubmit="return submitForm()">
            <div class="w-full flex justify-center items-center ">
                <div class="w-1/2 p-4 border border-blue-800 border-opacity-20 p-2 my-4 rounded-md drop-shadow-md">
                    <div id="messageContainer" class="text-xl text-green-500"></div>
                    <div class="font-bold text-2xl mb-4">
                        Pre-Registration
                    </div>
                    <div class="text-base">
                        We warmly welcome  senior high school graduates, college transferees, second coursers, and foreign applicants to our campus.
                        Kindly fill-out the pre-registration form for a fast and efficient admissions procedure.
                    </div>
                    <div class="mt-4 w-full">
                        <div class="justify-start items-center w-full gap-2">
                            <div class="font-bold text-lg w-auto mb-2">
                                You're applying for: 
                            </div>
                            <div class="items-center grid gap-2">
                                <div class="flex justify-start items-center gap-2">
                                    <div class="text-md font-semibold">Course:</div>
                                    <select name="course" class="text-sm p-1 border border-blue-200 rounded-md">
                                        <option value="1">Bachelor of Science in Information Technology</option>
                                        <option value="2">Bachelor of Science in Hospitality Management</option>
                                        <option value="3">Bachelor of Science in Business Administration</option>
                                        <option value="4">Bachelor of Elementary Education</option>
                                        <option value="5">Bachelor of Secondary Education major in English</option>
                                        <option value="6">Bachelor of Secondary Education major in Mathematics</option>
                                        <option value="7">Bachelor of Science in Criminology</option>
                                    </select>
                                </div>
                                <div class="flex justify-start items-center gap-2">
                                    <div class="text-md font-semibold">Preferred School Year:</div>
                                    <select name="schoolYear" id="schoolYear" class="text-sm p-1 border border-blue-200 rounded-md"></select>
                                </div>                                
                            </div>

                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="inline-flex justify-start items-center gap-2 mt-2">
                            <div><img src="./assets/svg/three-lines.svg" class="w-5 h-5" alt=""></div>
                            <div class="font-bold text-xl">Personal Information</div>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center gap-2 w-full">
                                <div class="w-full">
                                    <div>Surname</div>
                                    <div class="text-sm p-1 border border-blue-200 rounded-md w-full">
                                        <input type="text" id="stdSurname" name="stdSurname" autocomplete="family-name" required style="text-transform: capitalize;" class="w-full px-1" oninput="checkDuplicateName()">
                                    </div>
                                </div>
                                <div class="w-full">
                                    <div>First Name</div>
                                    <div class="text-sm p-1 border border-blue-200 rounded-md w-full">
                                        <input type="text" id="stdFirstname" name="stdFirstname" autocomplete="given-name" required style="text-transform: capitalize;" class="w-full px-1" oninput="checkDuplicateName()">
                                    </div>
                                </div>
                                <div class="w-full">
                                    <div>Middle Name</div>
                                    <div class="text-sm p-1 border border-blue-200 rounded-md w-full"><input type="text" id="stdMiddlename" name="stdMiddlename" required style="text-transform: capitalize;" class="w-full px-1"></div>
                                </div>
                                <div class="w-full">
                                    <div>Suffix</div>
                                    <div><select name="stdSuffix" id="suffixMenu" class="text-sm p-1 border border-blue-200 rounded-md w-full"></select></div>
                                </div>
                            </div>
                            <span id="duplicateMessage" class="text-red-500"></span>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="inline-flex justify-start items-center gap-2 mt-2">
                            <div><img src="./assets/svg/three-lines.svg" class="w-5 h-5" alt=""></div>
                            <div class="font-bold text-xl">Contact Information</div>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-start gap-2 w-full">
                                <div class="w-full">
                                    <div>City </div>
                                    <div><select name="stdCity" id="cityMenu" class="text-sm p-1 border border-blue-200 rounded-md w-full"></select></div>
                                </div>
                                <div class="w-full">
                                    <div>Email</div>
                                    <div class="text-sm p-1 border border-blue-200 rounded-md w-full flex justify-between items-center relative gap-2">
                                        <input type="text" name="email" id="email" class="w-full" autocomplete="email" oninput="validateEmail()">
                                    </div>  
                                    <div id="emailError" class="text-red-500"></div>               
                                </div>
                                <div class="w-full">
                                    <div>Cellphone</div>
                                    <div class="text-sm p-1 border border-blue-200 rounded-md inline-flex w-full">
                                        <span class="border-r border-blue-200 pr-2">+63</span>
                                        <span class="w-full">
                                            <input type="text" name="stdMobile" id="stdMobile" class="w-full px-1" required oninput="validatePhoneNumber()">
                                            <div id="phoneNumberError" class="text-red-500"></div>
                                        </span>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <div class="w-full flex justify-center items-center ">
                        <button type="submit" name="submit" value="Submit" class="bg-blue-400 mt-2 py-2 px-8 shadow inline-flex gap-2 text-white rounded-full hover:bg-blue-600 hover:font-semibold">Submit</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div>
        <div id="footerContainer"></div>
    </div>

    <script src="./assets/js/pre-registration-menu.js"></script>
    <script src="./assets/js/topbar.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function loadFooter() {
                const footerContainer = document.getElementById('footerContainer');
                const xhr = new XMLHttpRequest();
    
                xhr.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        footerContainer.innerHTML = this.responseText;
                    }
                };
    
                xhr.open('GET', './footer.html', true);
                xhr.send();
            }
    
            loadFooter();
        });
    </script>
    <script>
        function validatePhoneNumber() {
            const phoneNumberInput = document.getElementById('stdMobile');
            const phoneNumber = phoneNumberInput.value;
    
            const regex = /^9\d{9}$/;
            const isValid = regex.test(phoneNumber);
    
            const phoneNumberError = document.getElementById('phoneNumberError');
            if (!isValid) {
                phoneNumberError.textContent = 'Invalid phone number format. Must be a valid Philippine number starting with 9.';
            } else {
                phoneNumberError.textContent = ''; 
            }
        }
    
        document.getElementById('stdMobile').addEventListener('input', validatePhoneNumber);
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function getCurrentYear() {
                return new Date().getFullYear();
            }

            function populateSchoolYearDropdown() {
                const schoolYearDropdown = document.getElementById('schoolYear');
                const currentYear = getCurrentYear();

                for (let i = 0; i < 5; i++) {
                    const startYear = currentYear + i;
                    const endYear = startYear + 1;
                    const optionText = `${startYear}-${endYear}`;
                    const option = document.createElement('option');

                    option.value = optionText;
                    option.textContent = optionText;

                    schoolYearDropdown.appendChild(option);
                }
            }

            populateSchoolYearDropdown();
        });
    </script>
    <script>
        function checkDuplicateName() {
            var surname = $('#stdSurname').val();
            var firstname = $('#stdFirstname').val();
    
            $.ajax({
                type: 'POST',
                url: './php/check-duplicate-name.php',
                data: { surname: surname, firstname: firstname },
                dataType: 'json',
                success: function (response) {
                    if (response.status === 'error') {
                        console.log('Error: ' + response.message);
                    } else {
                        if (response.exists) {
                            $('#duplicateMessage').text('You have already submitted Pre-Registration Form. Please login to proceed.');
                        } else {
                            $('#duplicateMessage').text('');
                        }
                    }
                },
                error: function (xhr, status, error) {
                    console.log('AJAX error: ' + error);
                }
            });
        }
    </script>
    <script>
        function validateEmail() {
            const emailInput = document.getElementById('email');
            const email = emailInput.value;

            const regex = /\S+@\S+\.\S+/;
            const isValid = regex.test(email);

            const emailError = document.getElementById('emailError');

            if (!isValid) {
                emailError.textContent = 'Invalid email format. Example: example@gmail.com';
                return false;
            }

            const xhr = new XMLHttpRequest();
            xhr.open('POST', './php/check-duplicate-email.php', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);

                        if (response.status === 'error') {
                            emailError.textContent = response.message;
                        } else if (response.exists) {
                            emailError.textContent = 'Email already in use. Please choose another.';
                        } else {
                            emailError.textContent = '';
                        }
                    } else {
                        emailError.textContent = 'Error checking duplicate email.';
                    }
                }
            };

            const params = 'email=' + encodeURIComponent(email);
            xhr.send(params);

            return isValid;
        }
    </script>
    <script>
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        function displayMessage() {
            var message = getParameterByName('message');
            if (message) {
                $('#messageContainer').html('<p>' + message + '</p>');
            }
        }

        $(document).ready(function () {
            displayMessage();
        });
    </script>
</body>
</html>